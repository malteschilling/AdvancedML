<!DOCTYPE html><html><head><meta charset="utf-8">
<script src="assets/d3.min.js"></script>
<script src="http://distill.pub/template.v1.js"></script>
<script type="text/front-matter">
  title: Attention and Augmented Recurrent Neural Networks
  description: A visual overview of neural attention, and the powerful extensions of neural networks being built on top of it.
  authors:
    - Chris Olah: http://colah.github.io
    - Shan Carter: http://shancarter.com
  affiliations:
    - Google Brain: http://g.co/brain
    - Google Brain: http://g.co/brain
</script>

<style>
#previews a {
  text-decoration: none;
  overflow: hidden;
  margin-bottom: 12px;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 12px;
  padding-bottom: 12px;

}
#previews figcaption {
  margin-left: 100px;
}
#previews svg, #previews img {
  width: 80px;
  float: left;
}

@media(min-width: 768px) {
  #previews {
    overflow: hidden;
    margin-top: 48px;
    margin-bottom: 48px;
  }
  #previews figcaption {
    margin-left: 0;
  }
  #previews figcaption b {
    display: block;
  }
  #previews figcaption b span {
    display: block;
  }
  #previews a {
    position: relative;
    float: left;
    width: 19%;
    margin-right: 3.6%;
    padding-right: 3.6%;
    border-right: 1px solid rgba(0, 0, 0, 0.05);
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }
  #previews a:last-child {
    margin-right: 0;
    padding-right: 0;
    border-right: 0;
  }
  #previews svg, #previews img {
    margin-bottom: 18px;
    display: block;
    width: 100%;
    float: none;
  }
}

@media(min-width: 1024px) {
  #previews {
    margin-top: 90px;
    margin-bottom: 90px;
  }
}
</style>

</head><body><dt-article class="centered">

  <style>
    #previews a {
      text-decoration: none;
      overflow: hidden;
      margin-bottom: 0px;
      display: block;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      margin-bottom: 0px;
      padding-bottom: 0px;

  }
    #previews figcaption {
      margin-left: 100px;
    }
    #previews svg, #previews img {
      width: 80px;
      float: left;
    }

  @media(min-width: 768px) {
      #previews {
        overflow: hidden;
        margin-top: 0px;
        margin-bottom: 0px;
      }
      #previews figcaption {
        margin-left: 0;
      }
      #previews figcaption b {
        display: block;
      }
      #previews figcaption b span {
        display: block;
      }
      #previews a {
        position: relative;
        float: left;
        width: 19%;
        margin-right: 3.6%;
        padding-right: 3.6%;
        border-right: 1px solid rgba(0, 0, 0, 0.05);
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      #previews a:last-child {
        margin-right: 0;
        padding-right: 0;
        border-right: 0;
      }
      #previews svg, #previews img {
        margin-bottom: 0px;
        display: block;
        width: 100%;
        float: none;
      }
    }

  @media(min-width: 1024px) {
    #previews {
      margin-top: 0px;
      margin-bottom: 0px;
    }
  }
  </style>
  <p></p><figure class="l-body-outset" id="rnn-read">
    <dt-include src="assets/rnn_read.svg"><svg id="edges" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 744 0">

  <g id="read-result">
    <use width="36" height="0" transform="translate(157 0)" xlink:href="#array-vector"></use>
  </g>
  <g id="attention">
    <use id="array-positive-value-3" data-name="array-positive-value" width="36" height="0" transform="translate(48 11)" xlink:href="#array-positive-value"></use>
    <use width="36" height="0" transform="translate(84 11)" xlink:href="#array-positive-value"></use>
    <use width="36" height="0" transform="translate(120 11)" xlink:href="#array-positive-value"></use>
    <use width="36" height="0" transform="translate(156 11)" xlink:href="#array-positive-value"></use>
    <use width="36" height="0" transform="translate(192 11)" xlink:href="#array-positive-value"></use>
    <use width="36" height="0" transform="translate(228 11)" xlink:href="#array-positive-value"></use>
    <use width="36" height="0" transform="translate(264 11)" xlink:href="#array-positive-value"></use>
  </g>
  <g id="memory">
    <use width="36" height="0" transform="translate(48 71)" xlink:href="#array-vector"></use>
    <use width="36" height="0" transform="translate(84 71)" xlink:href="#array-vector"></use>
    <use width="36" height="0" transform="translate(120 71)" xlink:href="#array-vector"></use>
    <use width="36" height="0" transform="translate(156 71)" xlink:href="#array-vector"></use>
    <use width="36" height="0" transform="translate(192 71)" xlink:href="#array-vector"></use>
    <use width="36" height="0" transform="translate(228 71)" xlink:href="#array-vector"></use>
    <use id="array-vector-17" data-name="array-vector" width="36" height="0" transform="translate(264 71)" xlink:href="#array-vector"></use>
  </g>
</svg>
</dt-include>
  </figure><p></p>

  <p><dt-include src="assets/rnn_write.html"><script>
"use strict";
(function() {

  function appendArrowhead(selection) {
    selection.append("marker")
        .attr("id", "arrowhead")
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 5)
        .attr("refY", 0)
        .attr("markerWidth", 10)
        .attr("markerHeight", 10)
        .attr("orient", "auto")
      .append("path")
        .attr("d", "M0,-5L5,0L0,5")
        .style("fill", "none")
        .style("stroke", "grey");
  }

  var vectorScale = d3.scaleLinear()
      .domain([0, 1])
      .range([-14, 14]);

  var memoryData = [
    {x: 0.9, y: 0.9},
    {x: 0.8, y: 0.8},
    {x: 0.1, y: 0.9},
    {x: 0.4, y: 0.2},
    {x: 0.2, y: 0.2},
    {x: 0.4, y: 0.3},
    {x: 0.1, y: 0.5}
  ];

  var writeData = {x: 0.9, y: 0};

  //
  // Read
  //
  var nodeWidth = 36;
  var readHtml = d3.selectAll("#rnn-read");
  var svg = readHtml.select("svg");
  var result = svg.select("#read-result").style("opacity", 0);
  var resultBBox = result.node().getBBox();
  var memory = svg.selectAll("#memory use");
  var memoryBBox = svg.select("#memory").node().getBBox();
  var attention = svg.selectAll("#attention use");
  var attentionBBox = svg.select("#attention").node().getBBox();
  var path = svg.selectAll("#paths path");

  appendArrowhead(svg);
  var resultArrow = svg.append("line")
      .attr("class", "result-line")
      .attr("marker-end", "url(#arrowhead)")
      .style("stroke", "grey");

  memory.data(memoryData)
    .each(function(d, i) {
      this.style.opacity = 0;
      d.top = memoryBBox.y;
      d.left = memoryBBox.x + nodeWidth * i;
      d.width = nodeWidth;
    });

  var memoryVectors = svg.selectAll(".vector")
      .data(memoryData)
    .enter().append("line")
      .attr("class", "vector")
      .attr("transform", function(d) {
        return `translate(${d.left + d.width / 2 - vectorScale(d.x) / 2}, ${d.top + d.width / 2 - vectorScale(d.y) / 2})`
      })
      .attr("x2", function(d) { return  vectorScale(d.x); })
      .attr("y2", function(d) { return  vectorScale(d.y); })
      .attr("marker-end", "url(#arrowhead)")
      .style("stroke", "grey");

  function updateReadAttention(data) {
    attention.data(data)
        .style("opacity", function(d) { return  d + 0.05; });

    path.data(data)
        .style("stroke-opacity", function(d) { return  d + 0.1; });

    var resultX = d3.sum(memoryData, function(d, i) { return d.x * data[i]; }) / d3.sum(data);
    var resultY = d3.sum(memoryData, function(d, i) { return d.y * data[i]; }) / d3.sum(data);

    resultArrow
        .attr("transform",`translate(${resultBBox.x + resultBBox.width / 2 - vectorScale(resultX) / 2}, ${resultBBox.y + resultBBox.width / 2 - vectorScale(resultY) / 2})`)
        .attr("x2", function(d) { return  vectorScale(resultX); })
        .attr("y2", function(d) { return  vectorScale(resultY); });
  }

  var length = memory.size();
  var attentionData = d3.range(length).map(function() { return Math.random(); });
  updateReadAttention(attentionData);

  readHtml.on("mousemove", function() {
    var data = [];
    attention.each(function() {
      var bbox = this.getBoundingClientRect()
      var distance = Math.abs(bbox.left - d3.event.clientX + bbox.width / 2);
      data.push(Math.exp(-distance / 25));
    });
    data = data.map(function(d) { return  d / d3.sum(data); });
    updateReadAttention(data);
  });

  var initReadData = d3.range(attention.size()).map(function(d) { return  Math.exp(-d); });
  initReadData = initReadData.map(function(d) { return  d / d3.sum(initReadData); });
  updateReadAttention(initReadData);

  //
  // Write
  //

  var writeHtml = d3.selectAll("#rnn-write");
  var writeSvg = writeHtml.select("svg");
  var writeMemory = writeSvg.selectAll("#memory use");
  var writeMemoryBBox = writeSvg.select("#memory").node().getBBox();
  var writeNewMemory = writeSvg.selectAll("#new-memory use");
  var writeNewMemoryBBox = writeSvg.select("#new-memory").node().getBBox();
  var writeAttention = writeSvg.selectAll("#attention use");
  var writeAttentionBBox = writeSvg.select("#attention").node().getBBox();
  var writePath = writeSvg.selectAll("#paths path");
  var writeResult = writeSvg.select("#write-result").style("opacity", 0);
  var writeResultBBox = writeResult.node().getBBox();
  var newMemoryData = memoryData.map(function(){ return {}; });

  appendArrowhead(writeSvg);
  var writeArrow = writeSvg.append("line")
      .attr("class", "write-line")
      .attr("marker-end", "url(#arrowhead)")
      .style("stroke", "grey")
      .attr("transform", "translate(" + (writeResultBBox.x + writeResultBBox.width / 2 - vectorScale(writeData.x) / 2) + ", " + (writeResultBBox.y + writeResultBBox.width / 2 - vectorScale(writeData.y) / 2) + ")")
      .attr("x2", vectorScale(writeData.x))
      .attr("y2", vectorScale(writeData.y));

  writeMemory.data(memoryData)
    .each(function(d, i) {
      this.style.opacity = 0;
      d.top = writeMemoryBBox.y;
      d.left = writeMemoryBBox.x + i * nodeWidth;
      d.width = nodeWidth;
    });

  var writeMemoryVectors = writeSvg.selectAll(".vector")
      .data(memoryData)
    .enter().append("line")
      .attr("class", "vector")
      .attr("transform", function(d) {
        return "translate(" + (d.left + d.width / 2 - vectorScale(d.x) / 2) + ", " + (d.top + d.width / 2 - vectorScale(d.y) / 2) + ")";
      })
      .attr("x2", function(d) { return  vectorScale(d.x); })
      .attr("y2", function(d) { return  vectorScale(d.y); })
      .attr("marker-end", "url(#arrowhead)")
      .style("stroke", "grey");

  writeNewMemory.data(newMemoryData)
    .each(function(d, i) {
      this.style.opacity = 0;
      d.top = writeNewMemoryBBox.y;
      d.left = writeNewMemoryBBox.x + i * nodeWidth;
      d.width = nodeWidth;
    });

  var writeNewMemoryVectors = writeSvg.selectAll(".new-vector")
      .data(newMemoryData)
    .enter().append("line")
      .attr("class", "new-vector")
      .attr("marker-end", "url(#arrowhead)")
      .style("stroke", "grey");

  function updateWriteAttention(data) {
    newMemoryData.forEach(function(d, i) {
      d.x = (memoryData[i].x + writeData.x * data[i]) / (1 + data[i]);
      d.y = (memoryData[i].y + writeData.y * data[i]) / (1 + data[i]);
    });
    writeNewMemoryVectors
        .attr("transform", function(d) {
          return "translate(" + (d.left + d.width / 2 - vectorScale(d.x) / 2) + ", " + (d.top + d.width / 2 - vectorScale(d.y) / 2) + ")";
        })
        .attr("x2", function(d) { return  vectorScale(d.x); })
        .attr("y2", function(d) { return  vectorScale(d.y); });

    writeAttention.data(data)
        .style("opacity", function(d) { return  d + 0.05; });

    writePath.data(data)
        .style("stroke-opacity", function(d) { return  d + 0.1; });
  }

  writeHtml.on("mousemove", function() {
    var data = [];
    writeAttention.each(function() {
      var bbox = this.getBoundingClientRect()
      var distance = Math.abs(bbox.left - d3.event.clientX + bbox.width / 2);
      data.push(Math.exp(-distance / 25));
    });
    data = data.map(function(d) { return  d / d3.sum(data); });
    updateWriteAttention(data);
  });

  var initWriteData = d3.range(writeAttention.size()).map(function(d) { return  Math.exp(-d); });
  initWriteData = initWriteData.map(function(d) { return  d / d3.sum(initWriteData); });
  updateWriteAttention(initWriteData);

})();
</script>
</dt-include></p>

  <p></p><figure class="l-page" id="rnn-write-detail">
    <dt-include src="assets/rnn_write_detail.svg"><svg id="edges" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 984 756">
  <defs>
    <symbol id="array-5" data-name="array-5" viewBox="0 0 181.5 37.5">
      <rect x="0.75" y="0.75" width="180" height="36" rx="6" ry="6" fill="#fff" stroke="#8c8c8c" stroke-miterlimit="10" stroke-width="1.5"></rect>
      <line x1="36.5" y1="36.75" x2="36.5" y2="0.75" fill="none" stroke="#8c8c8c" stroke-miterlimit="10"></line>
      <line x1="72.5" y1="36.75" x2="72.5" y2="0.75" fill="none" stroke="#8c8c8c" stroke-miterlimit="10"></line>
      <line x1="108.5" y1="36.75" x2="108.5" y2="0.75" fill="none" stroke="#8c8c8c" stroke-miterlimit="10"></line>
      <line x1="144.5" y1="36.75" x2="144.5" y2="0.75" fill="none" stroke="#8c8c8c" stroke-miterlimit="10"></line>
    </symbol>
    <symbol id="array-1" data-name="array-1" viewBox="0 0 37.5 37.5">
      <rect x="0.75" y="0.75" width="36" height="36" rx="6" ry="6" fill="#fff" stroke="#8c8c8c" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </symbol>
    <symbol id="array-3" data-name="array-3" viewBox="0 0 109 37.5">
      <rect x="0.75" y="0.75" width="107.5" height="36" rx="6" ry="6" fill="#fff" stroke="#8c8c8c" stroke-miterlimit="10" stroke-width="1.5"></rect>
      <line x1="36.25" y1="36.75" x2="36.25" y2="0.75" fill="none" stroke="#8c8c8c" stroke-miterlimit="10"></line>
      <line x1="72.25" y1="36.75" x2="72.25" y2="0.75" fill="none" stroke="#8c8c8c" stroke-miterlimit="10"></line>
    </symbol>
    <symbol id="array-negative-value" data-name="array-negative-value" viewBox="0 0 36 36">
      <rect width="36" height="36" fill="#0080f7" opacity="0"></rect>
      <rect x="4.42" y="4.42" width="27.17" height="27.17" rx="6" ry="6" fill="#ff2bb6" opacity="0.8"></rect>
    </symbol>
    <symbol id="array-positive-value" data-name="array-positive-value" viewBox="0 0 36 36">
      <rect width="36" height="36" fill="#0080f7" opacity="0"></rect>
      <rect x="4.42" y="4.42" width="27.17" height="27.17" rx="6" ry="6" fill="#3a5edd" opacity="0.8"></rect>
    </symbol>
    <symbol id="array-vector" data-name="array-vector" viewBox="0 0 36 36">
      <rect width="36" height="36" fill="#d8c2f2" opacity="0"></rect>
      <g opacity="0.5">
        <g>
          <line x1="18" y1="24" x2="18" y2="13.08" fill="none" stroke="#000" stroke-miterlimit="10"></line>
          <polygon points="22.09 16.4 21.36 17.08 18 13.47 14.64 17.08 13.91 16.4 18 12 22.09 16.4"></polygon>
        </g>
      </g>
    </symbol>
    <symbol id="pointer" data-name="pointer" viewBox="0 0 26.87 26.87">
      <circle cx="13.43" cy="13.43" r="12.93" fill="none" stroke="#ffdc8c" stroke-miterlimit="10"></circle>
      <circle cx="13.43" cy="13.43" r="10.38" fill="#ffb200"></circle>
      <polygon points="11.32 19.26 11.32 17.43 10.72 17.43 10.71 16.14 10.1 16.21 10.1 15 9.54 14.99 9.46 13.78 8.88 13.78 8.89 13.16 8.28 13.16 8.28 11.34 10.11 11.34 10.11 11.94 10.71 11.94 10.71 6.46 11.33 6.45 11.33 5.86 12.54 5.86 12.54 6.45 13.16 6.47 13.16 8.89 14.37 8.89 14.39 9.49 16.21 9.51 16.21 10.12 17.43 10.12 17.43 10.79 18.04 10.73 18.05 11.39 18.65 11.33 18.65 15.61 18.04 15.52 17.98 17.43 17.43 17.43 17.43 19.26 11.32 19.26" fill="#fff" opacity="0.2"></polygon>
      <g>
        <path d="M10.11,11.94c0-.09,0-0.19,0-0.28s0-.21,0-0.32H8.28v1.82H8.89V11.95h1.23v0.63h0.6v0.6h0.61V13.09q0-2.4,0-4.8,0-.92,0-1.85h1.21V5.85H11.33v0.6H10.71v5.47h-0.6Zm4.28-2.44a0.45,0.45,0,0,1,0-.07c0-.15,0-0.3,0-0.45s0,0,0-.08H13.16V6.47H12.55v5.47h0.61V9.51h1.24s0,0.06,0,.09q0,1.12,0,2.25s0,0.07,0,.1H15V10.12h1.23v2.43h0.6V10.71l0.57,0s0,0,0,.05,0,0.29,0,.44,0,0.07,0,.11H18a0,0,0,0,1,.06.06c0,0.24,0,.48,0,0.72q0,1.71,0,3.41s0,0,0,.08h-0.6s0,0,0,0q0,0.86,0,1.72s0,0,0,.06H16.81v1.21H11.94V17.42H11.33V16.21h-0.6a11.4,11.4,0,0,0,0,1.22h0.6v1.83c2,0,4.07,0,6.11,0,0-.1,0-0.19,0-0.28,0-.46,0-0.93,0-1.39a1.53,1.53,0,0,0,0-.16H18c0.05,0,.07,0,0.07-0.07,0-.45,0-0.89,0-1.34,0-.13,0-0.26,0-0.4l0.3,0h0.3V11.33H18v-0.6H17.43V10.11H16.21V9.51H14.39ZM10.1,15v1.21h0.52a0.07,0.07,0,0,0,.08-0.08c0-.32,0-0.65,0-1,0-.06,0-0.11,0-0.17H10.11V13.77H9.49V13.16H8.91a2.7,2.7,0,0,0,0,.62H9.47s0,0,0,.07,0,0.27,0,.41,0,0.45,0,.68a0,0,0,0,0,.05.06H10.1Z" fill="#fff"></path>
        <path d="M17.43,17.43s0,0,0-.06q0-.86,0-1.72s0,0,0,0H18s0-.06,0-0.08q0-1.71,0-3.41c0-.24,0-0.48,0-0.72A0,0,0,0,0,18,11.33H17.44s0-.07,0-0.11,0-.29,0-0.44,0-.05,0-0.05l-0.57,0v1.84h-0.6V10.12H15v1.82H14.38s0-.07,0-0.1q0-1.12,0-2.25s0-.06,0-0.09h1.81v0.6h1.22v0.62H18v0.6h0.61v4.28h-0.3l-0.3,0c0,0.14,0,.27,0,0.4,0,0.45,0,.89,0,1.34,0,0.05,0,.07-0.07.07H17.43Z" fill="#fff"></path>
        <path d="M17.43,17.43a1.53,1.53,0,0,1,0,.16c0,0.46,0,.93,0,1.39,0,0.09,0,.17,0,0.28-2,0-4.06,0-6.11,0V17.43h-0.6a11.4,11.4,0,0,1,0-1.22h0.6v1.21h0.61v1.22h4.88V17.43h0.62Z" fill="#fff"></path>
        <path d="M11.33,6.45q0,0.92,0,1.85,0,2.4,0,4.8v0.07H10.72v-0.6h-0.6V11.93h0.6V6.46h0.61Z" fill="#fff"></path>
        <path d="M14.39,9.49H13.16v2.43H12.55V6.47h0.61V8.89h1.21s0,0.06,0,.08,0,0.3,0,.45a0.44,0.44,0,0,0,0,.07h0Z" fill="#fff"></path>
        <path d="M10.1,15H9.54a0,0,0,0,1-.05-0.06c0-.23,0-0.45,0-0.68s0-.27,0-0.41,0,0,0-.07H8.88a2.7,2.7,0,0,1,0-.62H9.49v0.61h0.62V15h0.61c0,0.06,0,.12,0,0.17,0,0.32,0,.65,0,1a0.07,0.07,0,0,1-.08.08H10.1V15Z" fill="#fff"></path>
        <path d="M10.11,11.93H8.89v1.21H8.28V11.34h1.83c0,0.11,0,.21,0,0.32s0,0.19,0,.28h0Z" fill="#fff"></path>
        <path d="M11.33,6.45V5.85h1.21v0.6H11.33Z" fill="#fff"></path>
      </g>
    </symbol>
  </defs>
  <title>rnn</title>
  <g>
    <line x1="763.09" y1="7" x2="763.59" y2="748" fill="#fff"></line>
    <g>
      <line x1="763.09" y1="7" x2="763.09" y2="8" fill="none" stroke="#aaa" stroke-miterlimit="10"></line>
      <line x1="763.09" y1="10" x2="763.59" y2="746" fill="none" stroke="#aaa" stroke-miterlimit="10" stroke-dasharray="2 2"></line>
      <line x1="763.59" y1="747" x2="763.59" y2="748" fill="none" stroke="#aaa" stroke-miterlimit="10"></line>
    </g>
  </g>
  <g>
    <g opacity="0">
      <g>
        <line x1="643.34" y1="208" x2="643.34" y2="250.92" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
        <path d="M643.34,256.35a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,643.34,256.35Z" fill="#666"></path>
      </g>
    </g>
    <g opacity="0.17">
      <g>
        <line x1="643.34" y1="213" x2="643.34" y2="250.92" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
        <path d="M643.34,256.35a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,643.34,256.35Z" fill="#666"></path>
      </g>
    </g>
    <g opacity="0.33">
      <g>
        <line x1="643.34" y1="218" x2="643.34" y2="250.92" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
        <path d="M643.34,256.35a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,643.34,256.35Z" fill="#666"></path>
      </g>
    </g>
    <g opacity="0.5">
      <g>
        <line x1="643.34" y1="223" x2="643.34" y2="250.92" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
        <path d="M643.34,256.35a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,643.34,256.35Z" fill="#666"></path>
      </g>
    </g>
    <g opacity="0.67">
      <g>
        <line x1="643.34" y1="228" x2="643.34" y2="250.92" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
        <path d="M643.34,256.35a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,643.34,256.35Z" fill="#666"></path>
      </g>
    </g>
    <g opacity="0.83">
      <g>
        <line x1="643.34" y1="233" x2="643.34" y2="250.92" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
        <path d="M643.34,256.35a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,643.34,256.35Z" fill="#666"></path>
      </g>
    </g>
    <g>
      <line x1="643.34" y1="238" x2="643.34" y2="250.92" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
      <path d="M643.34,256.35a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,643.34,256.35Z" fill="#666"></path>
    </g>
  </g>
  <g>
    <line x1="375" y1="55" x2="375" y2="79.75" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,85.18a27.2,27.2,0,0,0-4.28-7.69L375,79l4.28-1.55A27.18,27.18,0,0,0,375,85.18Z" fill="#666"></path>
  </g>
  <g>
    <line x1="794.09" y1="103" x2="428.43" y2="103" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M423,103a27.2,27.2,0,0,0,7.69-4.28L429.14,103l1.55,4.28A27.18,27.18,0,0,0,423,103Z" fill="#666"></path>
  </g>
  <g>
    <line x1="794.09" y1="373" x2="428.43" y2="373" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M423,373a27.2,27.2,0,0,0,7.69-4.28L429.14,373l1.55,4.28A27.18,27.18,0,0,0,423,373Z" fill="#666"></path>
  </g>
  <g>
    <line x1="794.09" y1="499" x2="428.43" y2="499" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M423,499a27.2,27.2,0,0,0,7.69-4.28L429.14,499l1.55,4.28A27.18,27.18,0,0,0,423,499Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="114.82" x2="375" y2="139.57" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,145a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,375,145Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="186.82" x2="375" y2="211.57" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,217a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,375,217Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="247" x2="375" y2="271.75" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,277.18a27.2,27.2,0,0,0-4.28-7.69L375,271l4.28-1.55A27.18,27.18,0,0,0,375,277.18Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="318.82" x2="375" y2="343.57" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,349a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,375,349Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="378.82" x2="375" y2="403.57" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,409a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,375,409Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="451" x2="375" y2="475.75" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,481.18a27.2,27.2,0,0,0-4.28-7.69L375,475l4.28-1.55A27.18,27.18,0,0,0,375,481.18Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="510.82" x2="375" y2="535.57" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,541a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,375,541Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="583.82" x2="375" y2="608.57" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,614a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,375,614Z" fill="#666"></path>
  </g>
  <g>
    <line x1="375" y1="642.82" x2="375" y2="667.57" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></line>
    <path d="M375,673a27.2,27.2,0,0,0-4.28-7.69l4.28,1.55,4.28-1.55A27.18,27.18,0,0,0,375,673Z" fill="#666"></path>
  </g>
  <g>
    <path d="M643.34,319v32a10,10,0,0,1-10,10H428.43" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></path>
    <path d="M423,361a27.2,27.2,0,0,0,7.69-4.28L429.14,361l1.55,4.28A27.18,27.18,0,0,0,423,361Z" fill="#666"></path>
  </g>
  <g>
    <g opacity="0.1">
      <rect x="334" y="621" width="84" height="24" rx="12" ry="12"></rect>
      <rect x="334" y="621" width="84" height="24" rx="12" ry="12" fill="none" stroke="#000" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
    <g>
      <rect x="333" y="619" width="84" height="24" rx="12" ry="12" fill="#fff"></rect>
      <rect x="333" y="619" width="84" height="24" rx="12" ry="12" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
  </g>
  <g>
    <g opacity="0.1">
      <rect x="334" y="489" width="84" height="24" rx="12" ry="12"></rect>
      <rect x="334" y="489" width="84" height="24" rx="12" ry="12" fill="none" stroke="#000" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
    <g>
      <rect x="333" y="487" width="84" height="24" rx="12" ry="12" fill="#fff"></rect>
      <rect x="333" y="487" width="84" height="24" rx="12" ry="12" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
  </g>
  <g>
    <g opacity="0.1">
      <rect x="334" y="357" width="84" height="24" rx="12" ry="12"></rect>
      <rect x="334" y="357" width="84" height="24" rx="12" ry="12" fill="none" stroke="#000" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
    <g>
      <rect x="333" y="355" width="84" height="24" rx="12" ry="12" fill="#fff"></rect>
      <rect x="333" y="355" width="84" height="24" rx="12" ry="12" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
  </g>
  <g>
    <g opacity="0.1">
      <rect x="334" y="225" width="84" height="24" rx="12" ry="12"></rect>
      <rect x="334" y="225" width="84" height="24" rx="12" ry="12" fill="none" stroke="#000" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
    <g>
      <rect x="333" y="223" width="84" height="24" rx="12" ry="12" fill="#fff"></rect>
      <rect x="333" y="223" width="84" height="24" rx="12" ry="12" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
  </g>
  <g>
    <g opacity="0.1">
      <rect x="334" y="93" width="84" height="24" rx="12" ry="12"></rect>
      <rect x="334" y="93" width="84" height="24" rx="12" ry="12" fill="none" stroke="#000" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
    <g>
      <rect x="333" y="91" width="84" height="24" rx="12" ry="12" fill="#fff"></rect>
      <rect x="333" y="91" width="84" height="24" rx="12" ry="12" fill="none" stroke="#666" stroke-miterlimit="10" stroke-width="1.5"></rect>
    </g>
  </g>
  <use id="array-5-3" data-name="array-5" width="181.5" height="37.5" transform="translate(284 281.75)" xlink:href="#array-5"></use>
  <use width="181.5" height="37.5" transform="translate(552.34 282.75)" xlink:href="#array-5"></use>
  <use width="181.5" height="37.5" transform="translate(284 413.75)" xlink:href="#array-5"></use>
  <use id="array-5-10" data-name="array-5" width="181.5" height="37.5" transform="translate(284 546.75)" xlink:href="#array-5"></use>
  <use width="181.5" height="37.5" transform="translate(284 677.75)" xlink:href="#array-5"></use>
  <use width="37.5" height="37.5" transform="translate(794.84 348.75)" xlink:href="#array-1"></use>
  <use id="array-3-3" data-name="array-3" width="109" height="37.5" transform="translate(794.84 479.75)" xlink:href="#array-3"></use>
  <use width="181.5" height="37.5" transform="translate(284 149.75)" xlink:href="#array-5"></use>
  <g id="dot">
    <use width="36" height="36" transform="translate(285 150.25)" xlink:href="#array-negative-value"></use>
    <use width="36" height="36" transform="translate(321 150)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(357 150)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(393 150)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(429 150)" xlink:href="#array-positive-value"></use>
  </g>
  <use id="array-5-17" data-name="array-5" width="181.5" height="37.5" transform="translate(284 18.75)" xlink:href="#array-5"></use>
  <g id="softmax">
    <use width="36" height="36" transform="translate(285 283)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(321 283)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(357 283)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(393 283)" xlink:href="#array-positive-value"></use>
    <use id="array-positive-value-19" data-name="array-positive-value" width="36" height="36" transform="translate(429 283)" xlink:href="#array-positive-value"></use>
  </g>
  <g id="shift">
    <use width="36" height="36" transform="translate(795.59 480)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(831.59 480)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(867.59 480)" xlink:href="#array-positive-value"></use>
  </g>
  <use id="interpolate-amount" width="36" height="36" transform="translate(795.59 349)" xlink:href="#array-positive-value"></use>
  <g id="previous">
    <use width="36" height="36" transform="translate(553.34 283)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(589.34 283)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(625.34 283)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(661.34 283)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(697.34 283)" xlink:href="#array-positive-value"></use>
  </g>
  <g id="interpolate">
    <use width="36" height="36" transform="translate(285 414)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(321 414)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(357 414)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(393 414)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(429 414)" xlink:href="#array-positive-value"></use>
  </g>
  <g id="convolve">
    <use width="36" height="36" transform="translate(284.5 548)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(321 548)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(357 548)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(393 548)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(429 548)" xlink:href="#array-positive-value"></use>
  </g>
  <g id="new-attention">
    <use width="36" height="36" transform="translate(285 678)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(321 678)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(357 678)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(393 678)" xlink:href="#array-positive-value"></use>
    <use width="36" height="36" transform="translate(429 678)" xlink:href="#array-positive-value"></use>
  </g>
  <use width="37.5" height="37.5" transform="translate(794.84 83.75)" xlink:href="#array-1"></use>
  <g opacity="0.6">
    <text transform="translate(76 75.88)" font-size="13" font-family="Open Sans">First, the controller gives a query <tspan x="0" y="20">vector and each memory entry is </tspan><tspan x="0" y="40">scored for similarity with the </tspan><tspan x="0" y="60">query.</tspan></text>
  </g>
  <g opacity="0.6">
    <text transform="translate(77.83 213.88)" font-size="13" font-family="Open Sans">The scores are then converted <tspan x="0" y="20">into a distribution using softmax.</tspan></text>
  </g>
  <g opacity="0.6">
    <text transform="translate(77.83 352.88)" font-size="13" font-family="Open Sans">Next, we interpolate the <tspan x="0" y="20">attention from the previous </tspan><tspan x="0" y="40">time step. </tspan></text>
  </g>
  <g opacity="0.6">
    <text transform="translate(77.83 465.88)" font-size="13" font-family="Open Sans">We convolve the attention with <tspan x="0" y="20">a shift filterâ€”this allows the </tspan><tspan x="0" y="40">controller to move its focus.</tspan></text>
  </g>
  <g opacity="0.6">
    <text transform="translate(77.83 598.88)" font-size="13" font-family="Open Sans">Finally, we sharpen the <tspan x="0" y="20">attention distribution. This </tspan><tspan x="0" y="40">final attention distribution is </tspan><tspan x="0" y="60">fed to the read or write </tspan><tspan x="0" y="80">operation.</tspan></text>
  </g>
  <g>
    <path d="M346.26,362.49a0.7,0.7,0,0,1,.19-0.52,0.72,0.72,0,0,1,.53-0.18,0.71,0.71,0,0,1,.52.18,0.7,0.7,0,0,1,.19.52,0.68,0.68,0,0,1-.19.51,0.7,0.7,0,0,1-.52.19,0.71,0.71,0,0,1-.53-0.19A0.68,0.68,0,0,1,346.26,362.49ZM347.6,370h-1.26v-5.94h1.26V370Z" fill="#666"></path>
    <path d="M354.63,370h-1.27v-3.65a1.6,1.6,0,0,0-.28-1,1.07,1.07,0,0,0-.88-0.34,1.4,1.4,0,0,0-1.17.47,2.61,2.61,0,0,0-.37,1.58v3H349.4v-5.94h1l0.18,0.78h0.06a1.75,1.75,0,0,1,.76-0.66,2.55,2.55,0,0,1,1.1-.23,1.91,1.91,0,0,1,2.14,2.18V370Z" fill="#666"></path>
    <path d="M358.6,369.09a3.07,3.07,0,0,0,.92-0.14v1a2.49,2.49,0,0,1-.54.15,3.73,3.73,0,0,1-.68.06,1.63,1.63,0,0,1-1.79-1.89V365h-0.81v-0.56l0.87-.46,0.43-1.26h0.78v1.32h1.69v1h-1.69v3.18a0.89,0.89,0,0,0,.23.67A0.83,0.83,0,0,0,358.6,369.09Z" fill="#666"></path>
    <path d="M363.3,370.11a2.87,2.87,0,0,1-2.17-.81,3.07,3.07,0,0,1-.78-2.23,3.37,3.37,0,0,1,.73-2.29,2.5,2.5,0,0,1,2-.83,2.45,2.45,0,0,1,1.86.71,2.73,2.73,0,0,1,.68,2v0.68h-4a2,2,0,0,0,.47,1.33,1.62,1.62,0,0,0,1.24.46,4.57,4.57,0,0,0,1-.1,5.06,5.06,0,0,0,1-.33v1a3.92,3.92,0,0,1-.93.31A5.76,5.76,0,0,1,363.3,370.11Zm-0.23-5.2a1.27,1.27,0,0,0-1,.38,1.81,1.81,0,0,0-.43,1.11h2.7a1.64,1.64,0,0,0-.35-1.11A1.21,1.21,0,0,0,363.07,364.91Z" fill="#666"></path>
    <path d="M370.06,364a3.08,3.08,0,0,1,.63.05l-0.12,1.18a2.39,2.39,0,0,0-.56-0.06,1.61,1.61,0,0,0-1.23.49,1.78,1.78,0,0,0-.47,1.28V370H367v-5.94h1l0.17,1h0.06a2.35,2.35,0,0,1,.77-0.84A1.84,1.84,0,0,1,370.06,364Z" fill="#666"></path>
    <path d="M374.8,370.11a2.08,2.08,0,0,1-1.75-.81H373q0.08,0.75.08,0.91v2.43h-1.26v-8.58h1q0,0.17.18,0.79h0.06a2,2,0,0,1,1.77-.9,2.06,2.06,0,0,1,1.73.81,4.42,4.42,0,0,1,0,4.53A2.08,2.08,0,0,1,374.8,370.11ZM374.5,365a1.31,1.31,0,0,0-1.1.44,2.29,2.29,0,0,0-.35,1.41V367a2.78,2.78,0,0,0,.34,1.57,1.28,1.28,0,0,0,1.12.49,1.14,1.14,0,0,0,1-.54,2.77,2.77,0,0,0,.35-1.53,2.68,2.68,0,0,0-.35-1.51A1.17,1.17,0,0,0,374.5,365Z" fill="#666"></path>
    <path d="M383.91,367a3.24,3.24,0,0,1-.75,2.27,2.67,2.67,0,0,1-2.08.82,2.84,2.84,0,0,1-1.47-.38,2.48,2.48,0,0,1-1-1.08,3.68,3.68,0,0,1-.34-1.63,3.22,3.22,0,0,1,.74-2.26,2.69,2.69,0,0,1,2.09-.81,2.62,2.62,0,0,1,2,.83A3.2,3.2,0,0,1,383.91,367Zm-4.32,0q0,2.06,1.52,2.06t1.5-2.06q0-2-1.51-2a1.29,1.29,0,0,0-1.15.53A2.68,2.68,0,0,0,379.59,367Z" fill="#666"></path>
    <path d="M386.62,370h-1.26v-8.36h1.26V370Z" fill="#666"></path>
    <path d="M392.14,370l-0.25-.83h0a2.42,2.42,0,0,1-.86.74,2.73,2.73,0,0,1-1.12.2,1.89,1.89,0,0,1-1.37-.47,1.77,1.77,0,0,1-.49-1.34,1.57,1.57,0,0,1,.68-1.39,3.94,3.94,0,0,1,2.08-.51l1,0v-0.32a1.2,1.2,0,0,0-.27-0.85,1.08,1.08,0,0,0-.82-0.28,2.84,2.84,0,0,0-.88.13,6.6,6.6,0,0,0-.81.32l-0.41-.9a4.41,4.41,0,0,1,1.06-.38,4.86,4.86,0,0,1,1.08-.13,2.57,2.57,0,0,1,1.71.49A1.94,1.94,0,0,1,393,366v4h-0.9Zm-1.88-.86a1.56,1.56,0,0,0,1.1-.38,1.39,1.39,0,0,0,.42-1.08v-0.52l-0.76,0a2.62,2.62,0,0,0-1.3.3,0.91,0.91,0,0,0-.41.81,0.79,0.79,0,0,0,.24.61A1,1,0,0,0,390.26,369.14Z" fill="#666"></path>
    <path d="M397,369.09a3.07,3.07,0,0,0,.92-0.14v1a2.49,2.49,0,0,1-.54.15,3.73,3.73,0,0,1-.68.06,1.63,1.63,0,0,1-1.79-1.89V365h-0.81v-0.56L395,364l0.43-1.26h0.78v1.32h1.69v1h-1.69v3.18a0.89,0.89,0,0,0,.23.67A0.83,0.83,0,0,0,397,369.09Z" fill="#666"></path>
    <path d="M401.73,370.11a2.87,2.87,0,0,1-2.17-.81,3.07,3.07,0,0,1-.78-2.23,3.37,3.37,0,0,1,.73-2.29,2.5,2.5,0,0,1,2-.83,2.45,2.45,0,0,1,1.86.71,2.73,2.73,0,0,1,.68,2v0.68h-4a2,2,0,0,0,.47,1.33,1.62,1.62,0,0,0,1.24.46,4.57,4.57,0,0,0,1-.1,5.06,5.06,0,0,0,1-.33v1a3.92,3.92,0,0,1-.93.31A5.76,5.76,0,0,1,401.73,370.11Zm-0.23-5.2a1.27,1.27,0,0,0-1,.38,1.81,1.81,0,0,0-.43,1.11h2.7a1.64,1.64,0,0,0-.35-1.11A1.21,1.21,0,0,0,401.5,364.91Z" fill="#666"></path>
  </g>
  <g>
    <path d="M354.78,502.11a2.6,2.6,0,0,1-2-.79,4,4,0,0,1,0-4.56,2.72,2.72,0,0,1,2.12-.81,4,4,0,0,1,1.69.35l-0.38,1a3.84,3.84,0,0,0-1.32-.31q-1.54,0-1.54,2a2.45,2.45,0,0,0,.38,1.5,1.33,1.33,0,0,0,1.13.5,3.23,3.23,0,0,0,1.6-.42v1.1a2.49,2.49,0,0,1-.72.28A4.31,4.31,0,0,1,354.78,502.11Z" fill="#666"></path>
    <path d="M363.1,499a3.24,3.24,0,0,1-.75,2.27,2.67,2.67,0,0,1-2.08.82,2.84,2.84,0,0,1-1.47-.38,2.48,2.48,0,0,1-1-1.08,3.68,3.68,0,0,1-.34-1.63,3.22,3.22,0,0,1,.74-2.26,2.69,2.69,0,0,1,2.09-.81,2.62,2.62,0,0,1,2,.83A3.2,3.2,0,0,1,363.1,499Zm-4.32,0q0,2.06,1.52,2.06t1.5-2.06q0-2-1.51-2a1.29,1.29,0,0,0-1.15.53A2.68,2.68,0,0,0,358.77,499Z" fill="#666"></path>
    <path d="M369.77,502H368.5v-3.65a1.6,1.6,0,0,0-.28-1,1.07,1.07,0,0,0-.88-0.34,1.4,1.4,0,0,0-1.17.47,2.61,2.61,0,0,0-.37,1.58v3h-1.26v-5.94h1l0.18,0.78h0.06a1.75,1.75,0,0,1,.76-0.66,2.55,2.55,0,0,1,1.1-.23,1.91,1.91,0,0,1,2.14,2.18V502Z" fill="#666"></path>
    <path d="M372.88,502l-2.26-5.94H372l1.21,3.45a6.85,6.85,0,0,1,.38,1.41h0a9.45,9.45,0,0,1,.38-1.41l1.21-3.45h1.34L374.25,502h-1.36Z" fill="#666"></path>
    <path d="M382.68,499a3.24,3.24,0,0,1-.75,2.27,2.67,2.67,0,0,1-2.08.82,2.84,2.84,0,0,1-1.47-.38,2.48,2.48,0,0,1-1-1.08,3.68,3.68,0,0,1-.34-1.63,3.22,3.22,0,0,1,.74-2.26,2.69,2.69,0,0,1,2.09-.81,2.62,2.62,0,0,1,2,.83A3.2,3.2,0,0,1,382.68,499Zm-4.32,0q0,2.06,1.52,2.06t1.5-2.06q0-2-1.51-2a1.29,1.29,0,0,0-1.15.53A2.68,2.68,0,0,0,378.36,499Z" fill="#666"></path>
    <path d="M385.4,502h-1.26v-8.36h1.26V502Z" fill="#666"></path>
    <path d="M388.55,502l-2.26-5.94h1.33l1.21,3.45a6.85,6.85,0,0,1,.38,1.41h0a9.45,9.45,0,0,1,.38-1.41l1.21-3.45h1.34L389.92,502h-1.36Z" fill="#666"></path>
    <path d="M395.68,502.11a2.87,2.87,0,0,1-2.17-.81,3.07,3.07,0,0,1-.78-2.23,3.37,3.37,0,0,1,.73-2.29,2.5,2.5,0,0,1,2-.83,2.45,2.45,0,0,1,1.86.71,2.73,2.73,0,0,1,.68,2v0.68h-4a2,2,0,0,0,.47,1.33,1.62,1.62,0,0,0,1.24.46,4.57,4.57,0,0,0,1-.1,5.06,5.06,0,0,0,1-.33v1a3.92,3.92,0,0,1-.93.31A5.76,5.76,0,0,1,395.68,502.11Zm-0.23-5.2a1.27,1.27,0,0,0-1,.38,1.81,1.81,0,0,0-.43,1.11h2.7a1.64,1.64,0,0,0-.35-1.11A1.21,1.21,0,0,0,395.45,496.91Z" fill="#666"></path>
  </g>
  <g>
    <path d="M358.08,632.31a1.55,1.55,0,0,1-.63,1.33,3,3,0,0,1-1.82.46,4.29,4.29,0,0,1-1.91-.36v-1.09a4.68,4.68,0,0,0,1.95.48q1.17,0,1.17-.7a0.56,0.56,0,0,0-.13-0.38,1.53,1.53,0,0,0-.42-0.31,7.3,7.3,0,0,0-.82-0.37,3.81,3.81,0,0,1-1.39-.79,1.47,1.47,0,0,1-.36-1,1.35,1.35,0,0,1,.62-1.18A2.92,2.92,0,0,1,356,628a4.74,4.74,0,0,1,2,.42l-0.41,1a4.4,4.4,0,0,0-1.62-.4q-1,0-1,.57a0.57,0.57,0,0,0,.26.47,5.72,5.72,0,0,0,1.14.53,5.19,5.19,0,0,1,1.07.52,1.56,1.56,0,0,1,.49.54A1.58,1.58,0,0,1,358.08,632.31Z" fill="#666"></path>
    <path d="M364.67,634H363.4v-3.65a1.6,1.6,0,0,0-.28-1,1.07,1.07,0,0,0-.88-0.34,1.39,1.39,0,0,0-1.17.48,2.62,2.62,0,0,0-.37,1.59V634h-1.26v-8.36h1.26v2.12a9.9,9.9,0,0,1-.06,1.09h0.08a1.76,1.76,0,0,1,.72-0.67,2.31,2.31,0,0,1,1.07-.24,1.92,1.92,0,0,1,2.16,2.18V634Z" fill="#666"></path>
    <path d="M370.14,634l-0.25-.83h0a2.43,2.43,0,0,1-.86.74,2.73,2.73,0,0,1-1.12.2,1.89,1.89,0,0,1-1.37-.47,1.77,1.77,0,0,1-.49-1.34,1.57,1.57,0,0,1,.68-1.39,3.93,3.93,0,0,1,2.08-.51l1,0v-0.32a1.2,1.2,0,0,0-.27-0.85,1.08,1.08,0,0,0-.82-0.28,2.86,2.86,0,0,0-.88.13,6.61,6.61,0,0,0-.81.32l-0.41-.9a4.37,4.37,0,0,1,1.06-.38,4.86,4.86,0,0,1,1.08-.13,2.57,2.57,0,0,1,1.71.49A1.94,1.94,0,0,1,371,630v4h-0.9Zm-1.88-.86a1.56,1.56,0,0,0,1.1-.38,1.39,1.39,0,0,0,.42-1.08v-0.52l-0.76,0a2.62,2.62,0,0,0-1.3.3,0.91,0.91,0,0,0-.41.81,0.79,0.79,0,0,0,.24.61A1,1,0,0,0,368.26,633.14Z" fill="#666"></path>
    <path d="M375.82,628a3,3,0,0,1,.63.05l-0.12,1.18a2.39,2.39,0,0,0-.56-0.06,1.61,1.61,0,0,0-1.23.49,1.79,1.79,0,0,0-.47,1.28V634H372.8v-5.94h1l0.17,1H374a2.35,2.35,0,0,1,.77-0.84A1.83,1.83,0,0,1,375.82,628Z" fill="#666"></path>
    <path d="M380.56,634.11a2.08,2.08,0,0,1-1.75-.81h-0.08q0.08,0.75.08,0.91v2.43h-1.26v-8.58h1q0,0.17.18,0.79h0.06a2,2,0,0,1,1.77-.9,2.06,2.06,0,0,1,1.73.81,4.42,4.42,0,0,1,0,4.53A2.08,2.08,0,0,1,380.56,634.11ZM380.25,629a1.31,1.31,0,0,0-1.1.44,2.29,2.29,0,0,0-.35,1.41V631a2.78,2.78,0,0,0,.34,1.57,1.28,1.28,0,0,0,1.12.49,1.14,1.14,0,0,0,1-.54,2.77,2.77,0,0,0,.35-1.53,2.68,2.68,0,0,0-.35-1.51A1.17,1.17,0,0,0,380.25,629Z" fill="#666"></path>
    <path d="M387,634.11a2.87,2.87,0,0,1-2.17-.81,3.07,3.07,0,0,1-.78-2.23,3.37,3.37,0,0,1,.73-2.29,2.5,2.5,0,0,1,2-.83,2.45,2.45,0,0,1,1.86.71,2.73,2.73,0,0,1,.68,2v0.68h-4a2,2,0,0,0,.47,1.33,1.63,1.63,0,0,0,1.24.46,4.57,4.57,0,0,0,1-.1,5.13,5.13,0,0,0,1-.33v1a3.88,3.88,0,0,1-.93.31A5.71,5.71,0,0,1,387,634.11Zm-0.23-5.2a1.27,1.27,0,0,0-1,.38,1.81,1.81,0,0,0-.43,1.11h2.7a1.64,1.64,0,0,0-.35-1.11A1.21,1.21,0,0,0,386.76,628.91Z" fill="#666"></path>
    <path d="M396,634H394.7v-3.65a1.6,1.6,0,0,0-.28-1,1.07,1.07,0,0,0-.88-0.34,1.4,1.4,0,0,0-1.17.47A2.61,2.61,0,0,0,392,631v3h-1.26v-5.94h1l0.18,0.78H392a1.76,1.76,0,0,1,.76-0.66,2.56,2.56,0,0,1,1.1-.23,1.91,1.91,0,0,1,2.14,2.18V634Z" fill="#666"></path>
  </g>
  <g>
    <path d="M358.22,236.31a1.55,1.55,0,0,1-.63,1.33,3,3,0,0,1-1.82.46,4.29,4.29,0,0,1-1.91-.36v-1.09a4.68,4.68,0,0,0,1.95.48q1.17,0,1.17-.7a0.56,0.56,0,0,0-.13-0.38,1.53,1.53,0,0,0-.42-0.31,7.3,7.3,0,0,0-.82-0.37,3.81,3.81,0,0,1-1.39-.79,1.47,1.47,0,0,1-.36-1,1.35,1.35,0,0,1,.62-1.18,2.92,2.92,0,0,1,1.67-.42,4.74,4.74,0,0,1,2,.42l-0.41,1a4.4,4.4,0,0,0-1.62-.4q-1,0-1,.57a0.57,0.57,0,0,0,.26.47,5.72,5.72,0,0,0,1.14.53,5.19,5.19,0,0,1,1.07.52,1.56,1.56,0,0,1,.49.54A1.58,1.58,0,0,1,358.22,236.31Z" fill="#666"></path>
    <path d="M364.85,235a3.24,3.24,0,0,1-.75,2.27,2.67,2.67,0,0,1-2.08.82,2.85,2.85,0,0,1-1.47-.38,2.48,2.48,0,0,1-1-1.08,3.68,3.68,0,0,1-.34-1.63,3.22,3.22,0,0,1,.74-2.26,2.69,2.69,0,0,1,2.09-.81,2.62,2.62,0,0,1,2,.83A3.2,3.2,0,0,1,364.85,235Zm-4.32,0q0,2.06,1.52,2.06t1.5-2.06q0-2-1.51-2a1.29,1.29,0,0,0-1.15.53A2.68,2.68,0,0,0,360.53,235Z" fill="#666"></path>
    <path d="M369.29,233h-1.45v5h-1.27v-5h-1v-0.59l1-.39v-0.39a2.16,2.16,0,0,1,.49-1.56,2,2,0,0,1,1.51-.51,4,4,0,0,1,1.31.22l-0.33,1a2.92,2.92,0,0,0-.89-0.15,0.73,0.73,0,0,0-.63.27,1.34,1.34,0,0,0-.2.8v0.39h1.45v1Z" fill="#666"></path>
    <path d="M372.51,237.09a3.07,3.07,0,0,0,.92-0.15v1a2.55,2.55,0,0,1-.54.15,3.73,3.73,0,0,1-.68.06,1.63,1.63,0,0,1-1.79-1.89V233H369.6v-0.56l0.87-.46,0.43-1.26h0.78v1.32h1.69v1h-1.69v3.18a0.89,0.89,0,0,0,.23.67A0.83,0.83,0,0,0,372.51,237.09Z" fill="#666"></path>
    <path d="M379.62,238h-1.27v-3.66a1.66,1.66,0,0,0-.26-1,1,1,0,0,0-.81-0.34,1.23,1.23,0,0,0-1.07.48,2.78,2.78,0,0,0-.34,1.58v3h-1.26v-5.94h1l0.18,0.78h0.06a1.64,1.64,0,0,1,.72-0.66,2.31,2.31,0,0,1,1-.23,1.81,1.81,0,0,1,1.82.93h0.09a1.81,1.81,0,0,1,.74-0.69,2.36,2.36,0,0,1,1.1-.25,2,2,0,0,1,1.55.54,2.38,2.38,0,0,1,.49,1.64V238h-1.26v-3.66a1.65,1.65,0,0,0-.26-1A1,1,0,0,0,381,233a1.25,1.25,0,0,0-1.08.46,2.37,2.37,0,0,0-.34,1.41V238Z" fill="#666"></path>
    <path d="M388.85,238l-0.25-.83h0a2.43,2.43,0,0,1-.86.74,2.73,2.73,0,0,1-1.12.2,1.89,1.89,0,0,1-1.37-.47,1.77,1.77,0,0,1-.49-1.34,1.57,1.57,0,0,1,.68-1.39,3.93,3.93,0,0,1,2.08-.51l1,0v-0.32a1.2,1.2,0,0,0-.27-0.85,1.08,1.08,0,0,0-.82-0.28,2.86,2.86,0,0,0-.88.13,6.61,6.61,0,0,0-.81.32l-0.41-.9a4.37,4.37,0,0,1,1.06-.38,4.86,4.86,0,0,1,1.08-.13,2.57,2.57,0,0,1,1.71.49,1.94,1.94,0,0,1,.58,1.55v4h-0.9Zm-1.88-.86a1.56,1.56,0,0,0,1.1-.38,1.39,1.39,0,0,0,.42-1.08v-0.52l-0.76,0a2.62,2.62,0,0,0-1.3.3,0.91,0.91,0,0,0-.41.81,0.79,0.79,0,0,0,.24.61A1,1,0,0,0,387,237.14Z" fill="#666"></path>
    <path d="M392.84,235l-2-2.91h1.44l1.35,2.08,1.36-2.08h1.43l-2,2.91,2.1,3H395.1l-1.47-2.22L392.18,238h-1.43Z" fill="#666"></path>
  </g>
  <g>
    <path d="M346.57,106.27a2.07,2.07,0,0,1-1.73-.81,4.42,4.42,0,0,1,0-4.54,2.09,2.09,0,0,1,1.75-.81,2,2,0,0,1,1.78.86h0.06a7.54,7.54,0,0,1-.09-1V97.81h1.27v8.36h-1l-0.22-.78h-0.06A2,2,0,0,1,346.57,106.27Zm0.34-1a1.37,1.37,0,0,0,1.13-.44,2.31,2.31,0,0,0,.37-1.42v-0.18a2.66,2.66,0,0,0-.37-1.6,1.36,1.36,0,0,0-1.14-.47,1.16,1.16,0,0,0-1,.54,2.77,2.77,0,0,0-.36,1.54,2.69,2.69,0,0,0,.35,1.51A1.18,1.18,0,0,0,346.91,105.25Z" fill="#666"></path>
    <path d="M356.69,103.19a3.24,3.24,0,0,1-.75,2.27,2.67,2.67,0,0,1-2.08.82,2.85,2.85,0,0,1-1.47-.38,2.48,2.48,0,0,1-1-1.08,3.68,3.68,0,0,1-.34-1.63,3.22,3.22,0,0,1,.74-2.26,2.69,2.69,0,0,1,2.09-.81,2.62,2.62,0,0,1,2,.83A3.2,3.2,0,0,1,356.69,103.19Zm-4.32,0q0,2.06,1.52,2.06t1.5-2.06q0-2-1.51-2a1.29,1.29,0,0,0-1.15.53A2.68,2.68,0,0,0,352.36,103.19Z" fill="#666"></path>
    <path d="M360.35,105.25a3.07,3.07,0,0,0,.92-0.15v1a2.55,2.55,0,0,1-.54.15,3.73,3.73,0,0,1-.68.06,1.63,1.63,0,0,1-1.79-1.89v-3.2h-0.81v-0.56l0.87-.46,0.43-1.26h0.78v1.32h1.69v1h-1.69v3.18a0.89,0.89,0,0,0,.23.67A0.83,0.83,0,0,0,360.35,105.25Z" fill="#666"></path>
    <path d="M368.33,106.27a2.08,2.08,0,0,1-1.75-.81h-0.08q0.08,0.75.08,0.91v2.43h-1.26v-8.58h1q0,0.17.18,0.79h0.06a2,2,0,0,1,1.77-.9,2.06,2.06,0,0,1,1.73.81,4.42,4.42,0,0,1,0,4.53A2.08,2.08,0,0,1,368.33,106.27ZM368,101.15a1.31,1.31,0,0,0-1.1.44,2.29,2.29,0,0,0-.35,1.41v0.19a2.78,2.78,0,0,0,.34,1.57,1.28,1.28,0,0,0,1.12.49,1.14,1.14,0,0,0,1-.54,2.77,2.77,0,0,0,.35-1.53,2.68,2.68,0,0,0-.35-1.51A1.17,1.17,0,0,0,368,101.15Z" fill="#666"></path>
    <path d="M375.19,100.12a3,3,0,0,1,.63.05l-0.12,1.18a2.39,2.39,0,0,0-.56-0.06,1.61,1.61,0,0,0-1.23.49,1.79,1.79,0,0,0-.47,1.28v3.1h-1.26v-5.94h1l0.17,1h0.06a2.35,2.35,0,0,1,.77-0.84A1.83,1.83,0,0,1,375.19,100.12Z" fill="#666"></path>
    <path d="M382.18,103.19a3.24,3.24,0,0,1-.75,2.27,2.67,2.67,0,0,1-2.08.82,2.85,2.85,0,0,1-1.47-.38,2.48,2.48,0,0,1-1-1.08,3.68,3.68,0,0,1-.34-1.63,3.22,3.22,0,0,1,.74-2.26,2.69,2.69,0,0,1,2.09-.81,2.62,2.62,0,0,1,2,.83A3.2,3.2,0,0,1,382.18,103.19Zm-4.32,0q0,2.06,1.52,2.06t1.5-2.06q0-2-1.51-2a1.29,1.29,0,0,0-1.15.53A2.68,2.68,0,0,0,377.86,103.19Z" fill="#666"></path>
    <path d="M385.64,106.27a2.07,2.07,0,0,1-1.73-.81,4.42,4.42,0,0,1,0-4.54,2.09,2.09,0,0,1,1.75-.81,2,2,0,0,1,1.78.86h0.06a7.54,7.54,0,0,1-.09-1V97.81h1.27v8.36h-1l-0.22-.78h-0.06A2,2,0,0,1,385.64,106.27Zm0.34-1a1.37,1.37,0,0,0,1.13-.44,2.31,2.31,0,0,0,.37-1.42v-0.18a2.66,2.66,0,0,0-.37-1.6,1.36,1.36,0,0,0-1.14-.47,1.16,1.16,0,0,0-1,.54,2.77,2.77,0,0,0-.36,1.54,2.69,2.69,0,0,0,.35,1.51A1.18,1.18,0,0,0,386,105.25Z" fill="#666"></path>
    <path d="M394.68,106.17l-0.18-.78h-0.06a1.79,1.79,0,0,1-.75.65,2.5,2.5,0,0,1-1.11.24,2.18,2.18,0,0,1-1.61-.54,2.23,2.23,0,0,1-.53-1.63v-3.88h1.27v3.66a1.59,1.59,0,0,0,.28,1,1.07,1.07,0,0,0,.88.34,1.39,1.39,0,0,0,1.17-.48,2.62,2.62,0,0,0,.37-1.59v-3h1.27v5.94h-1Z" fill="#666"></path>
    <path d="M399.87,106.27a2.6,2.6,0,0,1-2-.79,4,4,0,0,1,0-4.56,2.72,2.72,0,0,1,2.12-.81,4,4,0,0,1,1.69.35l-0.38,1a3.83,3.83,0,0,0-1.32-.31q-1.54,0-1.54,2a2.45,2.45,0,0,0,.38,1.5,1.33,1.33,0,0,0,1.13.5,3.23,3.23,0,0,0,1.6-.42v1.1a2.49,2.49,0,0,1-.72.28A4.34,4.34,0,0,1,399.87,106.27Z" fill="#666"></path>
    <path d="M405.13,105.25a3.07,3.07,0,0,0,.92-0.15v1a2.55,2.55,0,0,1-.54.15,3.73,3.73,0,0,1-.68.06,1.63,1.63,0,0,1-1.79-1.89v-3.2h-0.81v-0.56l0.87-.46,0.43-1.26h0.78v1.32H406v1H404.3v3.18a0.89,0.89,0,0,0,.23.67A0.83,0.83,0,0,0,405.13,105.25Z" fill="#666"></path>
  </g>
  <g id="query">
    <use id="q" width="36" height="36" transform="translate(795.59 85)" xlink:href="#array-vector"></use>
  </g>
  <g id="memory">
    <use width="36" height="36" transform="translate(285 19)" xlink:href="#array-vector"></use>
    <use width="36" height="36" transform="translate(321 19)" xlink:href="#array-vector"></use>
    <use width="36" height="36" transform="translate(357 19)" xlink:href="#array-vector"></use>
    <use width="36" height="36" transform="translate(393 19)" xlink:href="#array-vector"></use>
    <use width="36" height="36" transform="translate(429 19)" xlink:href="#array-vector"></use>
  </g>
  <use width="26.87" height="26.87" transform="translate(840.37 89.78)" xlink:href="#pointer"></use>
  <use width="26.87" height="26.87" transform="translate(841.72 353.66)" xlink:href="#pointer"></use>
  <use width="26.87" height="26.87" transform="translate(912.89 484.66)" xlink:href="#pointer"></use>
  <g opacity="0.6">
    <text transform="translate(558 -161.12)" font-size="13" font-family="Open Sans">The RNN gives an attention distribution, <tspan x="0" y="20">describing how much we should change </tspan><tspan x="0" y="40">each memory position towards the write </tspan><tspan x="0" y="60">value.</tspan></text>
  </g>
  <g opacity="0.6">
    <text transform="translate(475.41 40)" font-size="13" font-family="Open Sans">memory</text>
  </g>
  <g opacity="0.6">
    <text transform="translate(478.5 163.63)" font-size="13" font-family="Open Sans" font-style="italic">Blue shows high similarity, <tspan x="0" y="20">pink high dissimilarity.</tspan></text>
  </g>
  <g opacity="0.6">
    <text transform="translate(795.09 335)" font-size="13" font-family="Open Sans">interpolation amount</text>
  </g>
  <g opacity="0.6">
    <text transform="translate(795.09 467)" font-size="13" font-family="Open Sans">shift filter</text>
  </g>
  <g opacity="0.6">
    <text transform="translate(775.09 19)" font-size="13" font-family="Open Sans" font-style="italic">RNN controller</text>
  </g>
  <g opacity="0.6">
    <text transform="translate(628.56 19)" font-size="13" font-family="Open Sans" font-style="italic">attention mechanism</text>
  </g>
  <g opacity="0.6">
    <text transform="translate(795.09 71)" font-size="13" font-family="Open Sans">query vector</text>
  </g>
  <g opacity="0.6">
    <text transform="translate(557.03 273)" font-size="13" font-family="Open Sans">attention from previous step</text>
  </g>
  <g opacity="0.6">
    <text transform="translate(296.09 735)" font-size="13" font-family="Open Sans">new attention distribution</text>
  </g>
  <circle id="query-hover" cx="812.96" cy="102.44" r="87.04" fill="#fff" fill-opacity="0"></circle>
  <circle id="interpolate-hover" cx="812.96" cy="364.04" r="41.37" fill="#fff" fill-opacity="0"></circle>
  <rect id="shift-hover" x="775.59" y="456" width="168" height="84" fill-opacity="0" opacity="0.6"></rect>
</svg>
</dt-include>
  </figure><p></p>

  <p><dt-include src="assets/rnn_write_detail.html"><script>
"use strict";
//
// Data
//

var vectorScale = d3.scaleLinear().domain([0, 1]).range([-14, 14]);

var memoryData = [{ x: 0.4, y: 0.2 }, { x: 0.2, y: 0.2 }, { x: 0.1, y: 0.9 }, { x: 0.9, y: 0.9 }, { x: 0.4, y: 0.3 }];
var interpolationData = [0.3];
var shiftData = [0, 0.2, 0.8];
var previousAttentionData = [0, 0.2, 0, 0.2, 0.6];

//
// DOM
//

var nodeWidth = 36;
var html = d3.selectAll("#rnn-write-detail");
var svg = html.select("svg");
var query = svg.selectAll("#query").style("opacity", 0);
var memory = svg.selectAll("#memory use").style("opacity", 0);
var memoryBBox = svg.select("#memory").node().getBBox();
var shift = svg.selectAll("#shift use");

//
// Render
//

// Store positions of vectors
function cachePositions(selection) {
  selection.each(function (d) {
    var bBox = this.getBBox();
    d.top = bBox.y;
    d.left = bBox.x;
    d.width = bBox.width;
  });
}

// Render new vector lines
function renderVector(selection) {
  selection.attr("transform", function (d) {
    return "translate(" + (d.left + d.width / 2 - vectorScale(d.x) / 2) + ", " + (d.top + d.width / 2 - vectorScale(d.y) / 2) + ")";
  }).attr("x2", function (d) {
    return vectorScale(d.x);
  }).attr("y2", function (d) {
    return vectorScale(d.y);
  }).attr("marker-end", "url(#arrowhead)").style("stroke", "grey");
}

// Memory
memory.data(memoryData);
memory.each(function(d, i) {
  d.top = memoryBBox.y;
  d.left = memoryBBox.x + nodeWidth * i;
  d.width = nodeWidth;
})
// cachePositions(memory);
var memoryVector = svg.selectAll(".memory-vector").data(memoryData).enter().append("line").attr("class", "memory-vector");
renderVector(memoryVector);

var queryData = [{ x: 0.7, y: 0.8 }];
query.data(queryData);
cachePositions(query);

var queryVector = svg.selectAll(".query-vector").data(queryData).enter().append("line").attr("class", "query-vector");

var clamp = d3.scaleLinear().clamp(true);

function redraw() {

  renderVector(queryVector);

  // Dot
  var dotData = memoryData.map(function (v) {
    return 2 * (v.x - 0.5) * 2 * (queryData[0].x - 0.5) + 2 * (v.y - 0.5) * 2 * (queryData[0].y - 0.5);
  });
  svg.selectAll("#dot use").data(dotData).attr("xlink:href", function (d) {
    return d < 0 ? "#array-negative-value" : "#array-positive-value";
  }).style("opacity", function (d) {
    return Math.abs(d);
  });

  // Softmax
  var expDotData = dotData.map(Math.exp);
  var softmaxData = expDotData.map(function (x) {
    return x / d3.sum(expDotData);
  });
  svg.selectAll("#softmax use").data(softmaxData).style("opacity", function (d) {
    return d;
  });

  // Interpolate
  svg.selectAll("#previous use").data(previousAttentionData).style("opacity", function (d) {
    return d;
  });

  svg.selectAll("#interpolate-amount").data(interpolationData).style("opacity", function (d) {
    return d;
  });

  var interpolateData = previousAttentionData.map(function (d, i) {
    return interpolationData * d + (1 - interpolationData) * softmaxData[i];
  });
  svg.selectAll("#interpolate use").data(interpolateData).style("opacity", function (d) {
    return d;
  });

  // Convolve
  shift.data(shiftData).style("opacity", function (d) {
    return d;
  });

  var convolveData = dotData.map(function (x) {
    return 0;
  });
  for (var n in shiftData) {
    for (var i in convolveData) {
      if (i - (1 - n) >= 0) {
        convolveData[i - (1 - n)] += shiftData[n] * interpolateData[i];
      }
    }
  }
  // = dotData;
  svg.selectAll("#convolve use").data(convolveData).style("opacity", function (d) {
    return d;
  });

  // Sharpen
  var sharpenData = convolveData.map(function (x) {
    return x * x;
  });
  sharpenData = sharpenData.map(function (x) {
    return x / d3.sum(sharpenData);
  });
  svg.selectAll("#new-attention use").data(sharpenData).style("opacity", function (d) {
    return d;
  });
}

svg.select("#query-hover").on("mousemove", function () {
  var bbox = svg.select("#query").node().getBoundingClientRect();
  var x = d3.event.clientX - bbox.left - bbox.width / 2;
  var y = d3.event.clientY - bbox.top - bbox.height / 2;
  //TODO: this clamping is awkward
  queryData[0].x = clamp((x + 25) / 50);
  queryData[0].y = clamp((y + 25) / 50);
  redraw();
});
svg.select("#interpolate-hover").on("mousemove", function () {
  var bbox = svg.select("#interpolate-amount").node().getBoundingClientRect();
  interpolationData = [Math.max(0, Math.min(1, (d3.event.clientX - bbox.left) / bbox.width))];
  redraw();
});
// .on("mouseout", function() {
//   interpolationData = [0.3];
//   redraw();
// });

svg.select("#shift-hover").on("mousemove", function () {
  //  shiftData = [0, 0.2, 0.8];
  shiftData = [];
  shift.each(function () {
    var bbox = this.getBoundingClientRect();
    var distance = Math.abs(bbox.left - d3.event.clientX + bbox.width / 2);
    shiftData.push(Math.exp(-distance / 25));
  });
  shiftData = shiftData.map(function (d) {
    return d / d3.sum(shiftData);
  });
  redraw();
});
redraw();

</script>
</dt-include></p>

</dt-article>

<!-- Appendix -->
<dt-appendix class="centered">
  <h3>Acknowledgments</h3>
  <p>Thank you to Maithra Raghu, Dario Amodei, Cassandra Xia, Luke Vilnis, Anna Goldie, Jesse Engel, Dan ManÃ©, Natasha Jaques, Emma Pierson and Ian Goodfellow for their feedback and encouragement. We're also very grateful to our team, <a href="http://g.co/brain">Google Brain</a>, for being extremely supportive of our project.</p>

</dt-appendix>
<dt-footer></dt-footer>
<script type="text/bibliography">
@article{alemi2016deepmath,
  author    = {Alex A. Alemi and
               Fran{\c{c}}ois Chollet and
               Geoffrey Irving and
               Christian Szegedy and
               Josef Urban},
  title     = {DeepMath - Deep Sequence Models for Premise Selection},
  journal   = {CoRR},
  volume    = {abs/1606.04442},
  year      = {2016},
  url       = {http://arxiv.org/abs/1606.04442},
  timestamp = {Fri, 01 Jul 2016 17:39:49 +0200},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/AlemiCISU16},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{andrychowicz2016learning,
  author    = {Marcin Andrychowicz and
               Karol Kurach},
  title     = {Learning Efficient Algorithms with Hierarchical Attentive Memory},
  journal   = {CoRR},
  volume    = {abs/1602.03218},
  year      = {2016},
  url       = {http://arxiv.org/abs/1602.03218},
  timestamp = {Tue, 01 Mar 2016 17:47:25 +0100},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/AndrychowiczK16},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{bahdanau2014neural,
  title={Neural machine translation by jointly learning to align and translate},
  author={Bahdanau, Dzmitry and Cho, Kyunghyun and Bengio, Yoshua},
  journal={arXiv preprint arXiv:1409.0473},
  year={2014}
}

@article{chan2015listen,
  author    = {William Chan and
               Navdeep Jaitly and
               Quoc V. Le and
               Oriol Vinyals},
  title     = {Listen, Attend and Spell},
  journal   = {CoRR},
  volume    = {abs/1508.01211},
  year      = {2015},
  url       = {http://arxiv.org/abs/1508.01211},
  timestamp = {Tue, 01 Sep 2015 14:42:40 +0200},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/ChanJLV15},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{dzmitry2014neural,
  author    = {Dzmitry Bahdanau and
               Kyunghyun Cho and
               Yoshua Bengio},
  title     = {Neural Machine Translation by Jointly Learning to Align and Translate},
  journal   = {CoRR},
  volume    = {abs/1409.0473},
  year      = {2014},
  url       = {http://arxiv.org/abs/1409.0473},
  timestamp = {Wed, 01 Oct 2014 15:00:04 +0200},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/BahdanauCB14},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{graves2014neural,
  author    = {Alex Graves and
               Greg Wayne and
               Ivo Danihelka},
  title     = {Neural Turing Machines},
  journal   = {CoRR},
  volume    = {abs/1410.5401},
  year      = {2014},
  url       = {http://arxiv.org/abs/1410.5401},
  timestamp = {Sun, 02 Nov 2014 11:25:59 +0100},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/GravesWD14},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{graves2016adaptive,
  author    = {Alex Graves},
  title     = {Adaptive Computation Time for Recurrent Neural Networks},
  journal   = {CoRR},
  volume    = {abs/1603.08983},
  year      = {2016},
  url       = {http://arxiv.org/abs/1603.08983},
  timestamp = {Sat, 02 Apr 2016 11:49:48 +0200},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/Graves16},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@incollection{grefenstette2015learning,
  title = {Learning to Transduce with Unbounded Memory},
  author = {Grefenstette, Edward and Hermann, Karl Moritz and Suleyman, Mustafa and Blunsom, Phil},
  booktitle = {Advances in Neural Information Processing Systems 28},
  editor = {C. Cortes and N. D. Lawrence and D. D. Lee and M. Sugiyama and R. Garnett},
  pages = {1828--1836},
  year = {2015},
  publisher = {Curran Associates, Inc.},
  url = {http://papers.nips.cc/paper/5648-learning-to-transduce-with-unbounded-memory.pdf}
}

@incollection{joulin2015inferring,
  title = {Inferring Algorithmic Patterns with Stack-Augmented Recurrent Nets},
  author = {Joulin, Armand and Mikolov, Tomas},
  booktitle = {Advances in Neural Information Processing Systems 28},
  editor = {C. Cortes and N. D. Lawrence and D. D. Lee and M. Sugiyama and R. Garnett},
  pages = {190--198},
  year = {2015},
  publisher = {Curran Associates, Inc.},
  url = {http://papers.nips.cc/paper/5857-inferring-algorithmic-patterns-with-stack-augmented-recurrent-nets.pdf}
}

@article{kaiser2015neural,
  author    = {Lukasz Kaiser and
               Ilya Sutskever},
  title     = {Neural GPUs Learn Algorithms},
  journal   = {CoRR},
  volume    = {abs/1511.08228},
  year      = {2015},
  url       = {http://arxiv.org/abs/1511.08228},
  timestamp = {Tue, 01 Dec 2015 19:22:34 +0100},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/KaiserS15},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{kumar2015ask,
  author    = {Ankit Kumar and
               Ozan Irsoy and
               Jonathan Su and
               James Bradbury and
               Robert English and
               Brian Pierce and
               Peter Ondruska and
               Ishaan Gulrajani and
               Richard Socher},
  title     = {Ask Me Anything: Dynamic Memory Networks for Natural Language Processing},
  journal   = {CoRR},
  volume    = {abs/1506.07285},
  year      = {2015},
  url       = {http://arxiv.org/abs/1506.07285},
  timestamp = {Wed, 01 Jul 2015 15:10:24 +0200},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/KumarISBEPOGS15},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{kurach2015neural,
  author    = {Karol Kurach and
               Marcin Andrychowicz and
               Ilya Sutskever},
  title     = {Neural Random-Access Machines},
  journal   = {CoRR},
  volume    = {abs/1511.06392},
  year      = {2015},
  url       = {http://arxiv.org/abs/1511.06392},
  timestamp = {Tue, 01 Dec 2015 19:22:34 +0100},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/KurachAS15},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{neelakantan2015neural,
  author    = {Arvind Neelakantan and
               Quoc V. Le and
               Ilya Sutskever},
  title     = {Neural Programmer: Inducing Latent Programs with Gradient Descent},
  journal   = {CoRR},
  volume    = {abs/1511.04834},
  year      = {2015},
  url       = {http://arxiv.org/abs/1511.04834},
  timestamp = {Tue, 01 Dec 2015 19:22:34 +0100},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/NeelakantanLS15},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{olah2015understanding,
  title={Understanding LSTM Networks},
  author={Olah, Christopher},
  url={http://colah.github.io/posts/2015-08-Understanding-LSTMs},
  year={2015}
}

@article{reed2015neural,
  author    = {Scott E. Reed and
               Nando de Freitas},
  title     = {Neural Programmer-Interpreters},
  journal   = {CoRR},
  volume    = {abs/1511.06279},
  year      = {2015},
  url       = {http://arxiv.org/abs/1511.06279},
  timestamp = {Fri, 08 Apr 2016 07:34:31 +0200},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/ReedF15},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{silver2016mastering,
  doi = {10.1038/nature16961},
  url = {http://dx.doi.org/10.1038/nature16961},
  year = 2016,
  month = {jan},
  publisher = {Nature Publishing Group},
  volume = {529},
  number = {7587},
  pages = {484--489},
  author = {David Silver and Aja Huang and Chris J. Maddison and Arthur Guez and Laurent Sifre and George van den Driessche and Julian Schrittwieser and Ioannis Antonoglou and Veda Panneershelvam and Marc Lanctot and Sander Dieleman and Dominik Grewe and John Nham and Nal Kalchbrenner and Ilya Sutskever and Timothy Lillicrap and Madeleine Leach and Koray Kavukcuoglu and Thore Graepel and Demis Hassabis},
  title = {Mastering the game of Go with deep neural networks and tree search},
  journal = {Nature}
}

@article{vinyals2015neural,
  author    = {Oriol Vinyals and
               Quoc V. Le},
  title     = {A Neural Conversational Model},
  journal   = {CoRR},
  volume    = {abs/1506.05869},
  year      = {2015},
  url       = {http://arxiv.org/abs/1506.05869},
  timestamp = {Wed, 01 Jul 2015 15:10:24 +0200},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/VinyalsL15},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{weston2014memory,
  author    = {Jason Weston and
               Sumit Chopra and
               Antoine Bordes},
  title     = {Memory Networks},
  journal   = {CoRR},
  volume    = {abs/1410.3916},
  year      = {2014},
  url       = {http://arxiv.org/abs/1410.3916},
  timestamp = {Sun, 02 Nov 2014 11:25:59 +0100},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/WestonCB14},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@article{xu2015show,
  title={Show, attend and tell: Neural image caption generation with visual attention},
  author={Xu, Kelvin and Ba, Jimmy and Kiros, Ryan and Cho, Kyunghyun and Courville, Aaron and Salakhutdinov, Ruslan and Zemel, Richard S and Bengio, Yoshua},
  journal={arXiv preprint arXiv:1502.03044},
  volume={2},
  number={3},
  pages={5},
  year={2015},
  publisher={CoRR}
}

@article{zaremba2015reinforcement,
  author    = {Wojciech Zaremba and
               Ilya Sutskever},
  title     = {Reinforcement Learning Neural Turing Machines},
  journal   = {CoRR},
  volume    = {abs/1505.00521},
  year      = {2015},
  url       = {http://arxiv.org/abs/1505.00521},
  timestamp = {Mon, 01 Jun 2015 14:13:54 +0200},
  biburl    = {http://dblp.uni-trier.de/rec/bib/journals/corr/ZarembaS15},
  bibsource = {dblp computer science bibliography, http://dblp.org}
}

@inproceedings{vinyals2015grammar,
  title={Grammar as a foreign language},
  author={Vinyals, Oriol and Kaiser, {\L}ukasz and Koo, Terry and Petrov, Slav and Sutskever, Ilya and Hinton, Geoffrey},
  booktitle={Advances in Neural Information Processing Systems},
  pages={2773--2781},
  year={2015}
}

@inproceedings{vinyals2015pointer,
  title={Pointer networks},
  author={Vinyals, Oriol and Fortunato, Meire and Jaitly, Navdeep},
  booktitle={Advances in Neural Information Processing Systems},
  pages={2692--2700},
  year={2015}
}

</script>
</body></html>